<html>

<head>
    <meta charset="UTF-8" />
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="/js/script.js"></script>
    <title>RPi Server</title>
</head>

<body>
    <script>
        $(document).ready(function() {
            $("input:checkbox").prop("checked", false);

            $("#fileUploadInput").change(function() {
                $("#fileUploadForm").submit();
            });
        });

        $(document).on("click", "input:checkbox", function() {
            if($("input:checkbox:checked").length > 0) {
                $(addBtn).hide();
                $(deleteBtn).show();
            } else {
                $(addBtn).show();
                $(deleteBtn).hide(); 
            }
        });

        $(document).on("click", "#addBtn", function() {
            $("#addDropdown").show();
        });

        $(document).on("mouseup", function (e){
            var container = $("#addDropdown");
            if (!container.is(e.target) && container.has(e.target).length === 0){
                container.hide();
            }
        }); 

        $(document).on("click", "#uploadBtn", function() {
            $("#fileUploadInput").trigger("click");
        });
    </script>
    
    <div>
        <h1>RPi File Server</h1>

        <form id="fileUploadForm" action="{{url}}" method="post" enctype="multipart/form-data">
            <input type="file" name="fileUpload" id="fileUploadInput"/>
        </form>

        <div>
            <div class="actionContainer">
                <span class="actionBtn" id="addBtn">+</span>
                    <div id="addDropdown">
                        <div id="newFolderBtn" class="addOption topElement">New Folder</div>
                        <div id="uploadBtn" class="addOption">Upload File</div>
                    </div>
            </div>
            <div class="actionContainer">
                <span class="actionBtn" id="deleteBtn" onclick="deleteCheckedItems()">-</span>
            </div>
        </div>
    </div>

    <div>
        {{#dirs}}
        <div class="directoryLine dir">
            <label class="checkboxContainer">
                <input type="checkbox" class="dirCheckbox" value="{{dir}}">
                <span class="checkmark"></span>
            </label>
            <div class="directoryChunk" onclick="openFolder('{{dir}}');">
                <img class="folderIcon" src="/img/folder-icon.png">
                <div class="directoryItem">{{dir}}</div>
            </div>
        </div>
        {{/dirs}} {{#files}}
        <div class="directoryLine file">
            <label class="checkboxContainer">
                <input type="checkbox" class="fileCheckbox" value="{{file}}">
                <span class="checkmark"></span>
            </label>
            <img class="fileIcon" src="/img/file-icon.png">
            <div class="directoryItem">{{file}}</div>
        </div>
        {{/files}}
        <div class="directoryLine"></div>
    </div>
</body>

</html>